## 데드락 (DeadLock, 교착 상태)이란?

⇒ 서로 다른 프로세스나 스레드가 서로 상대방이 가지고 있는 자원을 점유하고 있으면서, 다른 자원을 요청하여 서로 무한히 기다리는 상황

*마치, 외나무 다리의 양 끝에서 서로가 비켜주기를 기다리고만 있는 것*

---

## 데드락 발생 조건

1. 상호 배제
    - 자원은 한번에 한 프로세스만 사용 가능
2. 점유 대기
    - 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 존재
3. 비선점
    - 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 빼앗을 수 없음
4. 순환 대기
    - 프로세스의 집합에서 순환 형태로 자원을 대기하고 있어야 함

---

## 데드락 처리

1. 예방
    - 데드 발생 조건 중 하나를 제거하면서 해결 (자원 낭비가 심함)
        - 상호배제 부정 : 여러 프로세스가 공유 자원 사용
        - 점유대기 부정 : 프로세스 실행 전 모든 자원을 할당
        - 비선점 부정 : 자원 점유 중인 프로세스가 다른 자원을 요구할 때 가진 자원 반납
        - 순환대기 부정 : 자원에 고유번호 할당 후 순서대로 자원 요구
2. 회피
    - 시스템이 자원 할당 상태를 미리 예측하여, 데드락이 발생하지 않도록 회피하는 방법
        
        은행원 알고리즘
        
        - 각 프로세스가 자원을 요청할 때마다, 요청한 자원을 임시로 할당해보고 데드락이 발생하지 않는지 검사해서 데드락이 발생하지 않으면 자원을 할당 해주는 방식, 아니면 다른 프로세스들이 자원 해지까지 대기
3. 탐지
    - 데드락이 발생하였는지 주기적으로 검사하여 탐지
4. 회복
    - 데드락이 발생한 경우, 프로세스나 자원을 중지하거나, 할당된 자원을 해제함으로써 회복하는 방법
        
        **프로세스 종료 방법**
        
        - 교착 상태의 프로세를 모두 중지
        - 교착 상태가 제거될 때까지 하나씩 프로세스 중지
        
        **자원 선점 방법**
        
        - 교착 상태의 프로세스가 점유하고 있는 자원을 선점해 다른 프로세스에게 할당
            
            (해당 프로세스 일시 정지)
            
        - 우선 순위가 낮은 프로세스나 수행 횟수가 적은 프로세스 위주로 프로세스 자원 선점

---

### 식사하는 철학자 문제

5명 철학자들이 원형 탁자에 앉아 있을때, 철학자들 옆에는 두개의 포크(원형탁자에 5개)가 존재

1. 생각을 하다가 왼쪽 포크가 사용 가능하면 집어든다.
2. 생각을 하다가 오른쪽 포크가 사용 가능하면 집어든다.
3. 왼쪽 오른쪽 포크를 모두 집었을때만 식사를 시작한다.
4. 식사 시간이 끝나면 오른쪽 포크를 내려놓는다.
5. 오른쪽 포크를 내려놓았으면 왼쪽 포크를 내려놓는다.


5명의 철학자와 5개의 포크가 존재할 때, 철학자마다 왼쪽 포크를 집고 있기 때문에 오른쪽 포크를 집기 위해서 오른쪽에 앉아 있는 철학자의 왼쪽 포크를 기다리게 돼 모든 철학자가 식사를 하지 못하는 상황이 발생

**즉, 철학자 = 프로세스,  포크 = 자원**


**교착 상태 해결책**

1. n명이 앉을 수 있는 테이블에서 철학자를 n-1명만 앉힘
2. 한 철학자가 포크 두개를 모두 집을 수 있는 상황에서만 포크 집도록 허용
3. 누군가는 왼쪽 포크를 먼저 집지 않고 오른쪽 포크을 먼저 집도록 허용
