## CAP 이론이란?

데이터베이스 시스템은 일관성(Consistency), 가용성(Availability), 분할 내구성(Partition Tolerance)의 3가지 특성 중 2가지 특성만을 충족할 수 있고 3가지 모두 충족할 수 없다는 이론

### Consistency (일관성)

일관성을 가진다는 것은 모든 데이터를 요청할 때 응답으로 가장 최신의 변경된 데이터를 리턴 또는 실패를 리턴한다는 것이다. 즉, 모든 읽기에 대해서 DB노드가 항상 동일한 데이터를 가지고 있어야 한다는 의미이다.

### Availability (가용성)

모든 요청에 대해서 정상적인 응답을 한다는 것이다. 클러스터의 노드 일부에서 장애가 발생하더라도 응답을 받을 수 있어야 한다. “특정 노드가 장애가 나도 서비스가 가능해야 한다”

### Partition Tolerance (분할 내구성)

DB Node간의 통신 장애가 발생하더라도 동작해야한다는 것이다. 데이터의 복제본을 여러 다른 노드에 저장하여 처리함으로써 동작할 수 있다.

![1](https://user-images.githubusercontent.com/72093196/231086927-73115ce8-70e4-4dd1-b6d9-a724ad4aa72e.png)

### Avaliablity vs Partition Tolerance

- availabity는 특정 노드가 “장애”가 발생한 상황
- partition tolerance는 노드의 상태는 정상이지만 네트워크 등의 문제로 서로간의 연결이 끊어진 상환

### CA (Consistency & Availability)

- 관계형 데이터베이스는 일반적으로 CA를 만족한다.
- 관계형 데이터베이스가 동시에 다량의 서버를 운용하는 클러스터링에 적합하지 않은 이유
    - 만약 10대의 서버중에서 한 서버의 접속이 끊어졌다고 가정하면, 분단 허용성을 지원하지 않아 이를 수용할 수 있지만 끊어진 서버 때문에 일관성과 가용성이 훼손되므로 10개의 서버 전부 중단시켜서 어떤 클라이언트와도 접속을 할 수 없도록 해야한다.

> **대부분의 NoSQL 데이터베이스는 CA가 아닌, CP나 AP 시스템이다.
(데이터의 신뢰성 보다는 분산에 중점을 둔 방식)**
>

### CP (Consistency & Partition Tolerance)

- 어떤 상황에서도 안정적으로 시스템은 운영된다.
- Consistency가 보장되지 않는다면 Error를 반환한다.

### AP (Availability & Partition Tolerance)

- 어떤 상황에서도 안정적으로 시스템은 운영된다.
- 데이터와 상관없이 안정적인 응답을 받을 수 있다. (다만, 데이터의 정합성에 대한 보장은 불가능)

### CAP 이론의 한계

분산 시스템은 CP이거나 AP여야 한다. 하지만 실제 시스템은 둘 중에 하나라도 명확히 구분 지을 수 없으며, 완벽한 CP 시스템이나 AP 시스템은 사실상 쓸모가 없다.

이런 한계점으로 PACELC 이론이 나옴.